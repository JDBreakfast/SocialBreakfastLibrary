<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Breakfast</title>
<style>
  :root {
    --bg: #0b0d10;
    --card: #0f1114;
    --muted: #9aa3ab;
    --accent: #ffd166;
    --pad: 12px;
    --gap: 12px;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  }

  body {
    margin: 0;
    background-color: var(--bg);
    color: #e6eef3;
  }

  h1 {
    text-align: center;
    margin: 20px 0;
    font-size: 28px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--gap);
    padding: var(--pad);
    max-width: 1440px;
    margin: 0 auto;
  }

  @media (max-width: 1024px) {
    .grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .grid {
      grid-template-columns: 1fr;
    }
  }

  .card {
    background: var(--card);
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 6px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }

  .embed-wrap {
    width: 100%;
    aspect-ratio: 1/1; /* square like Instagram grid */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
  }

  .embed-wrap iframe,
  .embed-wrap blockquote,
  .embed-wrap video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .link {
    margin-top: 4px;
    font-size: 10px;
    color: var(--muted);
    word-break: break-all;
    text-align: center;
  }

</style>
</head>
<body>

<h1>Social Breakfast</h1>
<div class="grid" id="grid">
  <p style="color:var(--muted); text-align:center;">Loading posts...</p>
</div>

<script>
function ensureInstagramScript(callback){
  if(window.instgrm && window.instgrm.Embeds){
    callback();
    return;
  }
  if(document.querySelector('script[data-instgrm]')){
    document.querySelector('script[data-instgrm]').addEventListener('load', callback);
    return;
  }
  const s = document.createElement('script');
  s.async = true;
  s.defer = true;
  s.src = 'https://www.instagram.com/embed.js';
  s.setAttribute('data-instgrm','');
  s.onload = callback;
  document.head.appendChild(s);
}

function createEmbed(url){
  // Instagram
  if(url.includes("instagram.com")) {
    const block = document.createElement('blockquote');
    block.className = 'instagram-media';
    block.setAttribute('data-instgrm-permalink', url);
    block.style.background = 'transparent';
    block.style.width = '100%';
    const a = document.createElement('a');
    a.href = url;
    block.appendChild(a);
    return block;
  }
  // TikTok
  else if(url.includes("tiktok.com")) {
    const iframe = document.createElement('iframe');
    iframe.src = url.replace("https://","https://www.") + "?embed=true";
    iframe.allow = "autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture";
    iframe.frameBorder = "0";
    iframe.style.width = "100%";
    iframe.style.height = "100%";
    iframe.style.objectFit = "cover";
    return iframe;
  }
  // Other links (Pinterest, Imgur, etc.)
  else {
    const a = document.createElement('a');
    a.href = url;
    a.target = "_blank";
    a.textContent = url;
    return a;
  }
}

async function loadPosts(){
  const grid = document.getElementById('grid');
  try{
    const res = await fetch('videos.json', {cache:'no-cache'});
    if(!res.ok) throw new Error('videos.json not found');
    const urls = await res.json();
    grid.innerHTML = '';
    urls.forEach(url=>{
      const card = document.createElement('div');
      card.className = 'card';
      const embedWrap = document.createElement('div');
      embedWrap.className = 'embed-wrap';
      embedWrap.appendChild(createEmbed(url));
      card.appendChild(embedWrap);
      const link = document.createElement('div');
      link.className = 'link';
      link.textContent = url;
      card.appendChild(link);
      grid.appendChild(card);
    });

    ensureInstagramScript(()=>{try{window.instgrm.Embeds.process()}catch(e){console.warn(e)}});
  } catch(err){
    console.error(err);
    grid.innerHTML = '<p style="text-align:center;color:#999;">Error loading videos.json</p>';
  }
}

window.addEventListener('load', loadPosts);
</script>

</body>
</html>
